<!DOCTYPE html>
<html>
<head>
    <title>Kommunaler Wertschöpfungsrechner</title>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
        {% load static %}
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <!-- CSS Datei einbinden -->
<link href="{% static 'style.css' %}" rel="stylesheet">
</head>
<body>
<div class="container mt-3">
    <h1>Kommunaler Wertschöpfungsrechner</h1>
    <p>Dies ist ein Tool zur Berechnung der kommunalen Wertschöpfung in brandenburgischen Gemeinden. Es liefert eine
        grobe Einschätzung des Wertschöpfungspotenzials basierend auf den eingegebenen Daten. Der Rechner ermittelt die
        möglichen Einnahmen durch die EEG-Beteiligung, den Wind- und Solar-Euro sowie Pachteinnahmen. Es ist wichtig zu
        beachten, dass die tatsächliche Wertschöpfung deutlich höher ausfallen kann, wenn lokale Unternehmen einbezogen
        werden, Bürger-Beteiligungen erfolgen und induzierte Effekte berücksichtigt werden. Dieses Tool bietet Kommunen
        die Möglichkeit, die direkte wirtschaftlichen Vorteile des Ausbaus erneuerbarer Energien abzuschätzen und fundierte
        Entscheidungen für eine nachhaltige Entwicklung zu treffen.</p>
    <hr>
    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-info mb-0">
                <p><b>Anwendungshinweis:</b></p>
                <p>Es reicht die Angabe der Potenzialfläche oder der maximal installierbaren
                    Leistung, insofern sie keine weiteren Informationen vorliegen haben. Weitere
                    benötigte Werte werden
                    mittels Standardverfahren und -werten berechnet.</p>
            </div>
        </div>
    </div>
    <hr>

    <p><b>In meiner Gemeinde gibt es Potenzial für:</b></p>
    <!-- Checkboxen zum Steuern der Akkordeon-Bereiche -->
    <div class="row mt-3 mb-3">
        <div class="col-md-3">
            <div class="form-check">
                <input class="form-check-input" id="checkbox1" onclick="toggleAccordions()" type="checkbox">
                <label class="form-check-label" for="checkbox1">
                    Windenergie (WEA)
                </label>
            </div>
        </div>
        <div class="col-md-3">

            <div class="form-check">
                <input class="form-check-input" id="checkbox2" onclick="toggleAccordions()" type="checkbox">
                <label class="form-check-label" for="checkbox2">
                    Freiflächen-Photovoltaik (FF-PV)
                </label>
            </div>
        </div>
        <div class="col-md-3">

            <div class="form-check">
                <input class="form-check-input" id="checkbox3" onclick="toggleAccordions()" type="checkbox">
                <label class="form-check-label" for="checkbox3">
                    Agri-Photovoltaik ver. (APVV)
                </label>
            </div>
        </div>
        <div class="col-md-3">

            <div class="form-check">
                <input class="form-check-input" id="checkbox4" onclick="toggleAccordions()" type="checkbox">
                <label class="form-check-label" for="checkbox4">
                    Agri-Photovoltaik hor. (APVH)
                </label>
            </div>
        </div>
    </div>
    <form action="{% url 'submit' %}" method="POST">
        {% csrf_token %}
        <div id="accordion">
            <!-- Bereich 1 -->
            <div class="card">
                <div class="card-header">
                    <a class="card-link light" data-toggle="collapse" href="#collapseGeneral">
                        Gemeindespezifische Informationen (Optional)
                    </a>
                </div>
                <div class="collapse" data-parent="#accordion" id="collapseGeneral">
                    <div class="card-body">
                        <div class="form-group">

                            <div class="row">
                                <div class="col-md-6">
                                    <label for="mun_key_num">
                                        Schlüsselzahl der Gemeinde (diese finden sie <a class="links"
                                                                                        href="https://bravors.brandenburg.de/sixcms/media.php/68/Anlage.64734510.pdf"
                                                                                        target="_blank"
                                                                                        title="Schlüsselzahlen brandenburgischer Gemeinden">hier</a>):
                                   <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                           title="Falls nicht bekannt, wird eine Schlüsselzahl von 0,003 angenommen."></i>
                                     </label>
                                    <input class="form-control" id="mun_key_num" name="mun_key_num"
                                           type="number">
                                </div>
                                <div class="col-md-6">
                                    <label for="levy_rate">
                                        Hebesatz der Gemeinde (diese finden sie <a class="links"
                                                                                   href="https://www.statistikportal.de/de/karte-hebesaetze"
                                                                                   target="_blank"
                                                                                   title="Hebesätze brandenburgischer Gemeinden">hier</a>):
                                        <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                           title="Falls nicht bekannt, wird der durchschnittliche Hebesatz für Brandenburg im Jahr 2022 angenommen (334 %)."></i>
                                    </label>
                                    <input class="form-control" id="levy_rate" name="levy_rate"
                                           type="number">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <a class="card-link disabled" data-toggle="collapse" href="#collapseOne" id="linkOne">
                        Windenergie (WEA)
                    </a>
                </div>
                <div class="collapse" data-parent="#accordion" id="collapseOne">
                    <div class="card-body">
                        <div class="form-group">

                            <div class="row">
                                <div class="col-md-6">
                                    <label for="wea_area_max">
                                        Größe der Potenzialfläche in ha:
                                        <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                           title="Die Fläche ist relevant für die Einnahmen durch Pachterlöse. Wenn nicht bekannt wird anhand der Anzahl der WEA eine Fläche berechnet."></i>
                                        <i class="fas fa-calculator" data-placement="right" data-toggle="tooltip"
                                           title="Wenn die Fläche in m² vorliegt, teilen Sie diese durch 10.000. Bei km² nehmen Sie die Fläche mal 100."></i>
                                    </label>
                                    <input class="form-control" disabled id="wea_area_max" name="wea_area_max"
                                           type="number">
                                </div>
                                <div class="col-md-6">
                                    <label for="wea_p_max">
                                        Maximal installierbare Leistung in MW:
                                        <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                           title="Geben Sie die Leistung in MW an, für die Sie die Wertschöpfung berechnen möchten. Alternativ wird die installierbare Leistung anhand der Potenzialfläche ermittelt."></i>
                                    </label>
                                    <input class="form-control" disabled id="wea_p_max" name="wea_p_max" type="number">
                                </div>

                            </div>

                            <div class="row align-items-center my-4 green">
                                <div class="col">
                                    <hr class="border-2 border-dark">
                                </div>
                                <div class="col-auto">
                                    <h6 class="mb-0"><b>Optional</b></h6>
                                </div>
                                <div class="col">
                                    <hr class="border-2 border-dark">
                                </div>
                            </div>
                            <div id="flaecheneigentuemer-container-wea">
                                <div class="row mt-3" id="flaecheneigentuemer-wea-1">
                                    <div class="col-md-6">
                                        <label for="wea_area_ownertype1">Flächeneigentum:
                                            <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                               title="Als Gemeinde erhalten Sie Einnahmen durch die Pachterlöse. Dies kann direkt erfolgen oder durch Steuereinnahmen je nach Eigentumsstruktur. Falls die Eigentümer nicht bekannt sind, werden die Pachteinnahmen nicht berücksichtigt."></i>
                                        </label>
                                        <select class="form-control" id="wea_area_ownertype1"
                                                name="wea_area_ownertype1">
                                            <option>Bitte wählen:</option>
                                            <option value="Privateigentum">Privateigentum</option>
                                            <option value="Gewerbliches Eigentum">Gewerbliches Eigentum</option>
                                            <option value="Gemeindeeigentum">Gemeindeeigentum</option>
                                            <option value="Landes-/Bundeseigentum">Landes-/Bundeseigentum</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="wea_anteil_flaeche1">Anteil an Fläche in %:</label>
                                        <input class="form-control" id="wea_anteil_flaeche1" name="wea_anteil_flaeche1"
                                               oninput="validateAnteilFlaeche('wea')"
                                               type="number">
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-secondary mt-3 btn-sm" id="addMoreBtn-wea" type="button">+
                                Flächeneigentümer hinzufügen
                            </button>
                            <button class="btn btn-danger mt-3 btn-sm" id="removeLastBtn-wea" style="display:none;"
                                    type="button">- Weniger Flächeneigentümer
                            </button>

                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <label for="rotor_diameter">Rotordurchmesser:</label>
                                    <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                       title="Insofern nur die Potenzialfläche bekannt ist, wird unter anderem anhand des Rotordurchmessers die maximale Anzahl an WEA berechnet."></i>
                                    <input class="form-control-range" id="rotor_diameter" max="200" min="100"
                                           name="rotor_diameter"
                                           oninput="this.nextElementSibling.value = this.value" type="range"
                                           value="130">
                                    <output>140</output>
                                </div>
                                <div class="col-md-6">
                                    <label for="system_output">Anlagenleistung:</label>
                                    <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                       title="Bitte geben Sie die Anlagenleistung in MW an, insofern bekannt."></i>
                                    <input class="form-control-range" id="system_output" max="8" min="2"
                                           name="system_output"
                                           oninput="this.nextElementSibling.value = this.value" type="range"
                                           value="4">
                                    <output>4</output>
                                </div>

                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <label for="wea_eeg_share">
                                        Prozentualer Anteil an EEG-Beteiligung:
                                        <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                           title="Die EEG-Beteiligung wird auf Gemeinden im 2,5-km-Umkreis verteilt, basierend auf ihrem Flächenanteil in diesem Radius."></i>
                                    </label>
                                    <input class="form-control" disabled id="wea_eeg_share" name="wea_eeg_share"
                                           type="number" value="100">
                                </div>
                                <div class="col-md-6">
                                    <label for="wind_euro_share">
                                        Prozentualer Anteil am Wind-Euro:
                                        <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                           title="Der Wind-Euro wird auf Gemeinden im 3-km-Umkreis verteilt, basierend auf ihrem Flächenanteil in diesem Radius."></i>
                                    </label>
                                    <input class="form-control" disabled id="wind_euro_share" name="wind_euro_share"
                                           type="number" value="100">
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Bereich 2 -->
                <div class="card">
                    <div class="card-header">
                        <a class="card-link disabled" data-toggle="collapse" href="#collapseTwo" id="linkTwo">
                            Freiflächen-Photovoltaik (FF-PV)
                        </a>
                    </div>
                    <div class="collapse" data-parent="#accordion" id="collapseTwo">
                        <div class="card-body">
                            <div class="form-group">

                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="ffpv_area_max">
                                            Größe der Potenzialfläche in ha:
                                            <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                               title="Die Fläche in ha ist relevant für die Einnahmen durch Pachterlöse. Wenn nicht bekannt wird diese anhand der maximal installierbaren Leistung berechnet."></i>
                                            <i class="fas fa-calculator" data-placement="right" data-toggle="tooltip"
                                               title="Wenn die Fläche in m² vorliegt, teilen Sie diese durch 10.000. Bei km² nehmen Sie die Fläche mal 100."></i>
                                        </label>
                                        <input class="form-control" disabled id="ffpv_area_max" name="ffpv_area_max"
                                               type="number">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="pv_p_max">
                                            Maximal installierbare Leistung:
                                            <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                               title="Geben Sie die Leistung in MW an, für die Sie die Wertschöpfung berechnen möchten. Alternativ wird die installierbare Leistung anhand der Potenzialfläche ermittelt."></i>
                                        </label>
                                        <input class="form-control" disabled id="pv_p_max" name="pv_p_max" type="number">
                                    </div>

                                </div>

                                <div class="row align-items-center my-4 green">
                                    <div class="col">
                                        <hr class="border-2 border-dark">
                                    </div>
                                    <div class="col-auto">
                                        <h6 class="mb-0"><b>Optional</b></h6>
                                    </div>
                                    <div class="col">
                                        <hr class="border-2 border-dark">
                                    </div>
                                </div>

                                <div id="flaecheneigentuemer-container-ffpv">
                                    <div class="row mt-3" id="flaecheneigentuemer-ffpv-1">
                                        <div class="col-md-6">
                                            <label for="ffpv_area_ownertype1">Flächeneigentum:
                                                <i class="fas fa-info-circle" data-placement="right"
                                                   data-toggle="tooltip"
                                                   title="Als Gemeinde erhalten Sie Einnahmen durch die Pachterlöse. Dies kann direkt erfolgen oder durch Steuereinnahmen je nach Eigentumsstruktur. Falls die Eigentümer nicht bekannt sind, werden die Pachteinnahmen nicht berücksichtigt."></i>
                                            </label>
                                            <select class="form-control" id="ffpv_area_ownertype1"
                                                    name="ffpv_area_ownertype1">
                                                <option>Bitte wählen:</option>
                                                <option value="Privateigentum">Privateigentum</option>
                                                <option value="Gewerbliches Eigentum">Gewerbliches Eigentum</option>
                                                <option value="Gemeindeeigentum">Gemeindeeigentum</option>
                                                <option value="Landes-/Bundeseigentum">Landes-/Bundeseigentum</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="ffpv_anteil_flaeche1">Anteil an Fläche in %:</label>
                                            <input class="form-control" id="ffpv_anteil_flaeche1"
                                                   name="ffpv_anteil_flaeche1" oninput="validateAnteilFlaeche('ffpv')"
                                                   type="number">
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary mt-3 btn-sm" id="addMoreBtn-ffpv" type="button">+
                                    Flächeneigentümer hinzufügen
                                </button>
                                <button class="btn btn-danger mt-3 btn-sm" id="removeLastBtn-ffpv" style="display:none;"
                                        type="button">- Weniger Flächeneigentümer
                                </button>

                            </div>
                        </div>
                    </div>

                    <!-- Bereich 3 -->
                    <div class="card">
                        <div class="card-header">
                            <a class="card-link disabled" data-toggle="collapse" href="#collapseThree" id="linkThree">
                                Agri-Photovoltaik vertikal (APVV)
                            </a>
                        </div>
            <div class="collapse" data-parent="#accordion" id="collapseThree">
                        <div class="card-body">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="apvv_area_max">
                                            Größe der Potenzialfläche in ha:
                                            <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                               title="Die Fläche ist relevant für die Einnahmen durch Pachterlöse. Wenn nicht bekannt wird diese anhand der maximal installierbaren Leistung berechnet."></i>
                                            <i class="fas fa-calculator" data-placement="right" data-toggle="tooltip"
                                               title="Wenn die Fläche in m² vorliegt, teilen Sie diese durch 10.000. Bei km² nehmen Sie die Fläche mal 100."></i>
                                        </label>
                                        <input class="form-control" disabled id="apvv_area_max" name="apvv_area_max"
                                               type="number">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="apv_ver_p_max">
                                            Maximal installierbare Leistung in MW:
                                            <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                                               title="Geben Sie die Leistung in MW an, für die Sie die Wertschöpfung berechnen möchten. Alternativ wird die installierbare Leistung anhand der Potenzialfläche ermittelt."></i>
                                        </label>
                                        <input class="form-control" disabled id="apv_ver_p_max" name="apv_ver_p_max"
                                               type="number">
                                    </div>
                                </div>
                                <div class="row align-items-center my-4 green">
                                    <div class="col">
                                        <hr class="border-2 border-dark">
                                    </div>
                                    <div class="col-auto">
                                        <h6 class="mb-0"><b>Optional</b></h6>
                                    </div>
                                    <div class="col">
                                        <hr class="border-2 border-dark">
                                    </div>
                                </div>
                                <div id="flaecheneigentuemer-container-apvv">
                                    <div class="row mt-3" id="flaecheneigentuemer-apvv-1">
                                        <div class="col-md-6">
                                            <label for="apvv_area_ownertype1">Flächeneigentum:
                                                <i class="fas fa-info-circle" data-placement="right"
                                                   data-toggle="tooltip"
                                                   title="Als Gemeinde erhalten Sie Einnahmen durch die Pachterlöse. Dies kann direkt erfolgen oder durch Steuereinnahmen je nach Eigentumsstruktur. Falls die Eigentümer nicht bekannt sind, werden die Pachteinnahmen nicht berücksichtigt."></i>
                                            </label>
                                            <select class="form-control" id="apvv_area_ownertype1"
                                                    name="apvv_area_ownertype1">
                                                <option>Bitte wählen:</option>
                                                <option value="Privateigentum">Privateigentum</option>
                                                <option value="Gewerbliches Eigentum">Gewerbliches Eigentum</option>
                                                <option value="Gemeindeeigentum">Gemeindeeigentum</option>
                                                <option value="Landes-/Bundeseigentum">Landes-/Bundeseigentum
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="apvv_anteil_flaeche1">Anteil an Fläche in %:</label>
                                            <input class="form-control" id="apvv_anteil_flaeche1"
                                                   name="apvv_anteil_flaeche1"
                                                   oninput="validateAnteilFlaeche('apvv')"
                                                   type="number">
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary mt-3 btn-sm" id="addMoreBtn-apvv" type="button">
                                    + Flächeneigentümer hinzufügen
                                </button>
                                <button class="btn btn-danger mt-3 btn-sm" id="removeLastBtn-apvv"
                                        style="display:none;"
                                        type="button">- Weniger Flächeneigentümer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Bereich 4 -->
                <div class="card">
                    <div class="card-header">
                        <a class="card-link disabled" data-toggle="collapse" href="#collapseFour" id="linkFour">
                            Agri-Photovoltaik horizontal (APVH)
                        </a>
                    </div>
                    <div class="collapse" data-parent="#accordion" id="collapseFour">
                        <div class="card-body">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="apvh_area_max">
                                            Größe der Potenzialfläche in ha:
                                            <i class="fas fa-info-circle" data-placement="right"
                                               data-toggle="tooltip"
                                               title="Die Fläche ist relevant für die Einnahmen durch Pachterlöse. Wenn nicht bekannt wird diese anhand der maximal installierbaren Leistung berechnet."></i>
                                            <i class="fas fa-calculator" data-placement="right"
                                               data-toggle="tooltip"
                                               title="Wenn die Fläche in m² vorliegt, teilen Sie diese durch 10.000. Bei km² nehmen Sie die Fläche mal 100."></i>
                                        </label>
                                        <input class="form-control" disabled id="apvh_area_max" name="apvh_area_max"
                                               type="number">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="apv_hor_p_max">
                                            Maximal installierbare Leistung in MW:
                                            <i class="fas fa-info-circle" data-placement="right"
                                               data-toggle="tooltip"
                                               title="Geben Sie die Leistung in MW an, für die Sie die Wertschöpfung berechnen möchten. Alternativ wird die installierbare Leistung anhand der Potenzialfläche ermittelt."></i>
                                        </label>
                                        <input class="form-control" disabled id="apv_hor_p_max" name="apv_hor_p_max"
                                               type="number">
                                    </div>
                                </div>
                                <div class="row align-items-center my-4 green">
                                    <div class="col">
                                        <hr class="border-2 border-dark">
                                    </div>
                                    <div class="col-auto">
                                        <h6 class="mb-0"><b>Optional</b></h6>
                                    </div>
                                    <div class="col">
                                        <hr class="border-2 border-dark">
                                    </div>
                                </div>

                                <div id="flaecheneigentuemer-container-apvh">
                                    <div class="row mt-3" id="flaecheneigentuemer-apvh-1">
                                        <div class="col-md-6">
                                            <label for="apvh_area_ownertype1">Flächeneigentum:
                                                <i class="fas fa-info-circle" data-placement="right"
                                                   data-toggle="tooltip"
                                                   title="Als Gemeinde erhalten Sie Einnahmen durch die Pachterlöse. Dies kann direkt erfolgen oder durch Steuereinnahmen je nach Eigentumsstruktur. Falls die Eigentümer nicht bekannt sind, werden die Pachteinnahmen nicht berücksichtigt."></i>
                                            </label>
                                            <select class="form-control" id="apvh_area_ownertype1"
                                                    name="apvh_area_ownertype1">
                                                <option>Bitte wählen:</option>
                                                <option value="Privateigentum">Privateigentum</option>
                                                <option value="Gewerbliches Eigentum">Gewerbliches Eigentum</option>
                                                <option value="Gemeindeeigentum">Gemeindeeigentum</option>
                                                <option value="Landes-/Bundeseigentum">Landes-/Bundeseigentum
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="apvh_anteil_flaeche1">Anteil an Fläche in %:</label>
                                            <input class="form-control" id="apvh_anteil_flaeche1"
                                                   name="apvh_anteil_flaeche1"
                                                   oninput="validateAnteilFlaeche('apvh')"
                                                   type="number">
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary mt-3 btn-sm" id="addMoreBtn-apvh" type="button">
                                    + Flächeneigentümer hinzufügen
                                </button>
                                <button class="btn btn-danger mt-3 btn-sm" id="removeLastBtn-apvh"
                                        style="display:none;"
                                        type="button">- Weniger Flächeneigentümer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary mt-3" type="submit">Absenden</button>
    </form>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();

        // Alle Checkboxen beim Laden der Seite deselektieren
        $('input[type="checkbox"]').prop('checked', false);

        // Alle Eingabefelder beim Laden der Seite leeren
        $('input[type="text"]').val('');

        // Sicherstellen, dass alle Akkordeon-Bereiche deaktiviert starten
        toggleAccordions();
    });

    function toggleAccordions() {
        // Alle Checkboxen und die zugehörigen Akkordeon-Bereiche
        let checkboxes = [
            {checkbox: $("#checkbox1"), collapse: "#collapseOne", link: "#linkOne"},
            {checkbox: $("#checkbox2"), collapse: "#collapseTwo", link: "#linkTwo"},
            {checkbox: $("#checkbox3"), collapse: "#collapseThree", link: "#linkThree"},
            {checkbox: $("#checkbox4"), collapse: "#collapseFour", link: "#linkFour"}
        ];

        checkboxes.forEach(function (item) {
            let collapseElement = $(item.collapse);
            let linkElement = $(item.link);
            if (item.checkbox.is(':checked')) {
                collapseElement.removeClass('disabled');
                collapseElement.addClass('show');
                linkElement.removeClass('disabled');
                collapseElement.find('input').prop('disabled', false);
            } else {
                collapseElement.addClass('disabled');
                linkElement.addClass('disabled');
                collapseElement.removeClass('show');
                collapseElement.find('input').prop('disabled', true);
            }
        });
    }

    function expandAllAccordions() {
        $('#accordion .collapse').collapse('show');
    }
</script>
<script>
    const counters = {
        'wea': 1,
        'ffpv': 1,
        'apvv': 1,
        'apvh': 1
    };

    function addFieldset(type) {
        counters[type]++;
        let container = document.getElementById(`flaecheneigentuemer-container-${type}`);

        let newFieldset = `
            <div class="row mt-3" id="flaecheneigentuemer-${type}-${counters[type]}">
                <div class="col-md-6">
                    <label for="${type}_area_ownertype${counters[type]}">Flächeneigentum:
                        <i class="fas fa-info-circle" data-placement="right" data-toggle="tooltip"
                           title="Als Gemeinde erhalten Sie Einnahmen durch die Pachterlöse. Dies kann direkt erfolgen oder durch Steuereinnahmen je nach Eigentumsstruktur. Falls die Eigentümer nicht bekannt sind, werden die Pachteinnahmen nicht berücksichtigt."></i>
                    </label>
                    <select class="form-control" id="${type}_area_ownertype${counters[type]}" name="${type}_area_ownertype${counters[type]}">
                        <option>Bitte wählen:</option>
                        <option value="Privateigentum">Privateigentum</option>
                        <option value="Gewerbliches Eigentum">Gewerbliches Eigentum</option>
                        <option value="Gemeindeeigentum">Gemeindeeigentum</option>
                        <option value="Landes-/Bundeseigentum">Landes-/Bundeseigentum</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="${type}_anteil_flaeche${counters[type]}">Anteil an Fläche in %:</label>
                    <input class="form-control" id="${type}_anteil_flaeche${counters[type]}" name="${type}_anteil_flaeche${counters[type]}" type="number" oninput="validateAnteilFlaeche('${type}')">
                    <small id="${type}_error_msg${counters[type]}" class="text-danger d-none">Die Summe der Flächenanteile liegt über 100 %. Bitte reduzieren sie die Anteile.</small>
                </div>
            </div>`;

        container.insertAdjacentHTML('beforeend', newFieldset);
        toggleRemoveButton(type);
        $('[data-toggle="tooltip"]').tooltip(); // Reinitialize tooltips
        validateAnteilFlaeche(type); // Validate after adding new fieldset
    }

    function removeFieldset(type) {
        if (counters[type] > 1) {
            let lastFieldset = document.getElementById(`flaecheneigentuemer-${type}-${counters[type]}`);
            lastFieldset.remove();
            counters[type]--;
            toggleRemoveButton(type);
            validateAnteilFlaeche(type); // Validate after removing fieldset
        }
    }

    function toggleRemoveButton(type) {
        let removeBtn = document.getElementById(`removeLastBtn-${type}`);
        if (counters[type] > 1) {
            removeBtn.style.display = 'inline-block';
        } else {
            removeBtn.style.display = 'none';
        }
    }

    function validateAnteilFlaeche(type) {
        let total = 0;
        let fields = document.querySelectorAll(`#flaecheneigentuemer-container-${type} input[name^="${type}_anteil_flaeche"]`);
        let isOver100 = false;
        fields.forEach((field, index) => {
            let value = parseFloat(field.value) || 0;
            total += value;
            let errorMsg = document.getElementById(`${type}_error_msg${index + 1}`);
            if (total > 100) {
                isOver100 = true;
                if (index === fields.length - 1) {
                    field.style.borderColor = 'red';
                    field.style.backgroundColor = 'red';
                    field.style.color = 'white';
                    field.style.fontWeight = 'bold';
                    errorMsg.classList.remove('d-none');
                }
            } else {
                field.style.borderColor = '';
                field.style.backgroundColor = '';
                field.style.fontWeight = '';
                field.style.color = '';
                if (errorMsg) errorMsg.classList.add('d-none');
            }
        });

        document.querySelector('button[type="submit"]').disabled = isOver100;
        return isOver100;
    }

    // Event listeners for adding/removing fieldsets
    document.getElementById('addMoreBtn-wea').addEventListener('click', function () {
        addFieldset('wea');
    });

    document.getElementById('removeLastBtn-wea').addEventListener('click', function () {
        removeFieldset('wea');
    });

    document.getElementById('addMoreBtn-ffpv').addEventListener('click', function () {
        addFieldset('ffpv');
    });

    document.getElementById('removeLastBtn-ffpv').addEventListener('click', function () {
        removeFieldset('ffpv');
    });

    document.getElementById('addMoreBtn-apvv').addEventListener('click', function () {
        addFieldset('apvv');
    });

    document.getElementById('removeLastBtn-apvv').addEventListener('click', function () {
        removeFieldset('apvv');
    });

    document.getElementById('addMoreBtn-apvh').addEventListener('click', function () {
        addFieldset('apvh');
    });

    document.getElementById('removeLastBtn-apvh').addEventListener('click', function () {
        removeFieldset('apvh');
    });

    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
        toggleRemoveButton('wea'); // Initiale Prüfung zum Verstecken des Buttons
        toggleRemoveButton('ffpv');
        toggleRemoveButton('apvv');
        toggleRemoveButton('apvh');
    });
</script>
</body>
</html>
